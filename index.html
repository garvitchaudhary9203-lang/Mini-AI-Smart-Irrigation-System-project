<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hydro-AI:SIS</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M12 3v18M12 3c-1.105 0-2 .895-2 2s.895 2 2 2h0c1.105 0 2-.895 2-2s-.895-2-2-2zM4 14h16m-8 0a4 4 0 100-8 4 4 0 000 8z'/%3E%3C/svg%3E" type="image/svg+xml">
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.2.0/dist/tf.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-moment@1.0.1/dist/chartjs-adapter-moment.min.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithCustomToken, signInAnonymously, onAuthStateChanged, signOut, signInWithEmailAndPassword, createUserWithEmailAndPassword, sendPasswordResetEmail, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, onSnapshot, collection, query, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        // --- Realtime Database Imports for ESP32 Data ---
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-database.js";
        // -----------------------------------------------------

        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = {
            apiKey: "AIzaSyCvKwpHAvcu9QSJDjqf_zdiTSGDpdNrJbw",
            authDomain: "mini-ai-irrigation-system.firebaseapp.com",
            projectId: "mini-ai-irrigation-system",
            storageBucket: "mini-ai-irrigation-system.firebasestorage.app",
            messagingSenderId: "205361105789",
            appId: "1:205361105789:web:4c75a11eab0f8263265a14",
            measurementId: "G-KM4XGDFSDR",
            databaseURL: "https://mini-ai-irrigation-system-default-rtdb.firebaseio.com/", 
        };
        const APIKey = "AIzaSyBrYLpAq3WY8OqPpRY6-cEwOhnoQoypygE"; // Assuming you will replace this
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${APIKey}`;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? initialAuthToken : null;
        
        let db;
        let rtdb; 
        let auth;
        let userId;
        // B. CHART JAVASCRIPT LOGIC (NEW GLOBAL VARIABLE)
        let moistureChart; 
        // END NEW GLOBAL VARIABLE
        let sensorData = {
            'zone1': { moisture: 0, temperature: 0, humidity: 0, crop: 'Lavender' },
            'zone2': { moisture: 0, temperature: 0, humidity: 0, crop: 'Zoysia Grass' },
            'zone3': { moisture: 0, temperature: 0, humidity: 0, crop: 'Tomatoes' },
            'zone4': { moisture: 0, temperature: 0, humidity: 0, crop: 'Apple Trees' }
        };
        let currentWeatherData = { temperature: 25, humidity: 65, condition: "Partly Cloudy" };
        let isPumpOn = false;
        let activeZone = 'zone1';

        // --- NEW: TensorFlow.js Model Integration Variables ---
        let tfjsModel;
        // üëáüëáüëá YOUR SCALER PARAMETERS (Mean, Std Dev) PASTE HERE üëáüëáüëá
        const SCALER_MEAN = [45.4859625, 22.5528125, 44.98325]; 
        const SCALER_STD = [26.002991230790848, 13.259638412861953, 14.716702057102202];    
        // üëÜüëÜüëÜ THIS IS CRUCIAL FOR MODEL ACCURACY üëÜüëÜüëÜ

        setLogLevel('debug');

        const crops = {
            'Lavender': {
                photo: 'https://placehold.co/200x200/4c3b53/f3e8ff?text=Lavender',
                description: 'A drought-tolerant perennial that thrives in full sun and well-drained soil. Requires minimal watering once established.'
            },
            'Zoysia Grass': {
                photo: 'https://placehold.co/200x200/526d3d/d2ffc0?text=Zoysia+Grass',
                description: 'A warm-season grass known for its durability and drought resistance. It requires less water than other common lawn types.'
            },
            'Tomatoes': {
                photo: 'https://placehold.co/200x200/c72c1c/fff5e0?text=Tomatoes',
                description: 'A heat-loving vegetable that requires consistent moisture to prevent cracking and blossom-end rot. Needs more frequent watering.'
            },
            'Apple Trees': {
                photo: 'https://placehold.co/200x200/942b00/d9b48f?text=Apple+Trees',
                description: 'Established trees have deep roots and require less frequent but deep watering. Proper irrigation is crucial for fruit development.'
            }
        };
        
        // ... (aiPredict, loadModel, initFirebase, setupRtdbListener, setupRealtimeListeners functions are unchanged) ...

        // ... (updatePumpStatus, updateAiMode, updateSensorReadings, updateWeatherData, updateCropsAndCropsInfo, simulateAiLogic, updateDiagnostics, addMessage, generateAiResponse, handleChatInput, handleVoiceInput functions are unchanged) ...

        // B. CHART JAVASCRIPT LOGIC (NEW FUNCTION)
        function renderMoistureChart(zoneId) {
            const ctx = document.getElementById('moistureChart').getContext('2d');
            const data = sensorData[zoneId];
            
            // --- SIMULATED HISTORICAL DATA (Replace with real Firebase logs later) ---
            const historicalData = [];
            const now = moment();
            
            for (let i = 6; i >= 0; i--) {
                // Simple simulation: moisture value decreases slightly over time
                const simulatedMoisture = data.moisture + (i - 3) * 5; 
                historicalData.push({
                    x: now.clone().subtract(i, 'days').toDate(),
                    y: Math.min(100, Math.max(0, simulatedMoisture))
                });
            }

            // 1. Destroy existing chart instance if it exists
            if (moistureChart) {
                moistureChart.destroy();
            }

            // 2. Create the new chart instance
            moistureChart = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [{
                        label: `Moisture Trend - ${data.crop}`,
                        data: historicalData,
                        borderColor: '#10B981', // Tailwind green-500 equivalent
                        backgroundColor: 'rgba(16, 185, 129, 0.2)', // Light fill
                        fill: true,
                        tension: 0.4 // Smooth the line
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false, // Allows it to fit the h-48 container
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            type: 'time', // Chart.js Moment adapter is needed for this
                            time: {
                                unit: 'day'
                            },
                            title: {
                                display: true,
                                text: 'Date',
                                color: '#94A3B8'
                            },
                            ticks: {
                                color: '#94A3B8'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        },
                        y: {
                            min: 0,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Soil Moisture (%)',
                                color: '#94A3B8'
                            },
                            ticks: {
                                color: '#94A3B8'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        }
                    }
                }
            });
        }
        // END NEW FUNCTION
        
        // ... (startSimulation, getDiagnosticsSummary, getCropInformation, showMessage, updateActiveTab functions are unchanged) ...

        // B. CHART JAVASCRIPT LOGIC (UPDATE setActiveZone)
        function setActiveZone(zoneId) {
            activeZone = zoneId;
            const data = sensorData[zoneId];
            if (data) {
                const moisture = data.moisture !== undefined ? Math.round(data.moisture) : 0;
                document.getElementById('zoneDetailTitle').textContent = `${data.crop} - Zone ${zoneId.replace('zone', '')}`;
                document.getElementById('moistureValue').textContent = `${moisture}%`;
                document.getElementById('moistureBar').style.width = `${moisture}%`;
                document.getElementById('moistureBar').className = `h-full rounded-full ${moisture > 60 ? 'bg-green-500' : moisture > 30 ? 'bg-yellow-500' : 'bg-red-500'}`;
                document.getElementById('tempValue').textContent = `${data.temperature !== undefined ? Math.round(data.temperature) : '--'}¬∞C`;
                document.getElementById('humidityValue').textContent = `${data.humidity !== undefined ? Math.round(data.humidity) : '--'}%`;
                
                // CALL THE CHART FUNCTION HERE
                renderMoistureChart(zoneId); 
            }
        }
        // END UPDATE setActiveZone

        // ... (updateAuthView, handleEmailSignUp, handleEmailLogin, handleGoogleLogin, handlePasswordReset, handleSignOut functions are unchanged) ...

        window.onload = function() {
            initFirebase();
            updateActiveTab('dashboard');
            
            // Set up dark mode based on local storage or system preference
            if (localStorage.theme === 'light' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: light)').matches)) {
                document.body.setAttribute('data-theme', 'light');
            } else {
                document.body.setAttribute('data-theme', 'dark');
            }

            document.getElementById('mode-toggle').addEventListener('click', () => {
                const isLightMode = document.body.getAttribute('data-theme') === 'light';
                const newTheme = isLightMode ? 'dark' : 'light';
                document.body.setAttribute('data-theme', newTheme);
                localStorage.theme = newTheme;
            });

            document.getElementById('pumpControlButton').addEventListener('click', async () => {
                const pumpStatus = isPumpOn ? "off" : "on";
                await savePumpStatus(pumpStatus);
            });

            document.getElementById('aiModeToggle').addEventListener('change', async (event) => {
                const isAiMode = event.target.checked;
                await saveAiMode(isAiMode);
            });

            document.getElementById('tab-btn-dashboard').addEventListener('click', () => updateActiveTab('dashboard'));
            document.getElementById('tab-btn-assistant').addEventListener('click', () => updateActiveTab('assistant'));
            document.getElementById('tab-btn-diagnostics').addEventListener('click', () => updateActiveTab('diagnostics'));
            document.getElementById('tab-btn-crops').addEventListener('click', () => {
                updateActiveTab('crops');
                updateCropsAndCropsInfo();
            });
            
            document.getElementById('sendButton').addEventListener('click', handleChatInput);
            document.getElementById('voiceButton').addEventListener('click', handleVoiceInput);
            document.getElementById('chatInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    handleChatInput();
                }
            });

            document.querySelectorAll('.zone-card').forEach(card => {
                card.addEventListener('click', (event) => {
                    const zoneId = event.currentTarget.dataset.zone;
                    setActiveZone(zoneId);
                    document.getElementById('dashboardView').classList.add('hidden');
                    document.getElementById('zoneDetailView').classList.remove('hidden');
                });
            });

            document.getElementById('showDashboard').addEventListener('click', () => {
                document.getElementById('dashboardView').classList.remove('hidden');
                document.getElementById('zoneDetailView').classList.add('hidden');
            });
            
            // Auth listeners
            document.getElementById('login-form').addEventListener('submit', handleEmailLogin);
            document.getElementById('signup-form').addEventListener('submit', handleEmailSignUp);
            document.getElementById('google-login-btn').addEventListener('click', handleGoogleLogin);
            document.getElementById('forgot-password-link').addEventListener('click', handlePasswordReset);
            document.getElementById('logout-btn').addEventListener('click', handleSignOut);
            
            document.getElementById('showSignup').addEventListener('click', (e) => {
                e.preventDefault();
                updateAuthView('signup');
            });
            document.getElementById('showLogin').addEventListener('click', (e) => {
                e.preventDefault();
                updateAuthView('login');
            });
        };
    </script>
    <style>
        /* ... (rest of the style is unchanged) ... */
    </style>
</head>
<body data-theme="dark" class="min-h-screen p-4 sm:p-8 flex items-center justify-center">
    
    <div id="authContainer" class="w-full max-w-sm bg-gray-900 rounded-2xl p-6 sm:p-10 shadow-lg border border-gray-800">
        <div id="login" class="auth-view">
            <h2 class="text-3xl font-bold text-center text-gray-100 mb-6">Log In</h2>
            <form id="login-form">
                <div class="mb-4">
                    <input type="email" id="loginEmail" placeholder="Email" class="w-full p-3 rounded-lg bg-gray-800 text-gray-200 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-green-500" required>
                </div>
                <div class="mb-6">
                    <input type="password" id="loginPassword" placeholder="Password" class="w-full p-3 rounded-lg bg-gray-800 text-gray-200 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-green-500" required>
                </div>
                <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-lg transition-colors">Log In</button>
            </form>
            <div class="text-center mt-4 text-gray-400 text-sm">
                <a href="#" id="forgot-password-link" class="hover:text-green-400">Forgot Password?</a>
            </div>
            <div class="text-center my-4 text-gray-500">
                OR
            </div>
            <div class="flex flex-col space-y-3">
                <button id="google-login-btn" class="w-full flex items-center justify-center gap-2 bg-gray-800 hover:bg-gray-700 text-white font-bold py-3 rounded-lg transition-colors border border-gray-700">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M22.56 12.28c0-.78-.07-1.54-.2-2.28H12v4.51h6.24c-.28 1.48-1.15 2.76-2.52 3.63v3.29h4.21a11.16 11.16 0 003.57-8.15z" />
                        <path d="M12 23.99c2.83 0 5.19-.93 6.92-2.52l-4.2-3.29c-1.15.77-2.6.99-4.32.99-3.32 0-6.14-2.23-7.14-5.22H.67v3.29a12 12 0 0011.33 8.75z" />
                        <path d="M4.86 14.12c-.5-.14-1.01-.2-1.52-.2-.51 0-1.02.06-1.52.2V10.83H.67a12.02 12.02 0 000 6.34h1.15a8.77 8.77 0 013.04-4.22z" />
                        <path d="M12 4.86c1.69 0 3.2.58 4.39 1.77l3.77-3.77A11.96 11.96 0 0012 .13C5.64.13.38 5.4.38 12h1.15c0-4.6 3.06-8.52 7.29-9.87z" />
                    </svg>
                    <span>Sign in with Google</span>
                </button>
            </div>
            <div class="text-center mt-6 text-gray-400">
                Don't have an account? <a href="#" id="showSignup" class="text-green-400 font-semibold hover:underline">Sign up</a>
            </div>
        </div>
        <div id="signup" class="auth-view hidden">
            <h2 class="text-3xl font-bold text-center text-gray-100 mb-6">Sign Up</h2>
            <form id="signup-form">
                <div class="mb-4">
                    <input type="email" id="signupEmail" placeholder="Email" class="w-full p-3 rounded-lg bg-gray-800 text-gray-200 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-green-500" required>
                </div>
                <div class="mb-6">
                    <input type="password" id="signupPassword" placeholder="Password" class="w-full p-3 rounded-lg bg-gray-800 text-gray-200 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-green-500" required>
                </div>
                <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-lg transition-colors">Sign Up</button>
            </form>
            <div class="text-center mt-6 text-gray-400">
                Already have an account? <a href="#" id="showLogin" class="text-green-400 font-semibold hover:underline">Log In</a>
            </div>
        </div>
    </div>

    <div id="appContainer" class="hidden w-full max-w-4xl bg-gray-900 rounded-2xl p-6 sm:p-10 shadow-lg border border-gray-800">
        <header class="flex flex-col sm:flex-row items-start sm:items-center justify-between mb-8">
            <div class="flex items-center gap-4 mb-4 sm:mb-0">
                <div class="p-2 bg-green-500 rounded-full">
                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v18M12 3c-1.105 0-2 .895-2 2s.895 2 2 2h0c1.105 0 2-.895 2-2s-.895-2-2-2zM4 14h16m-8 0a4 4 0 100-8 4 4 0 000 8z"></path>
                    </svg>
                </div>
                <h1 class="text-3xl sm:text-4xl font-bold text-gray-100">Hydro-AI</h1>
            </div>
            <div class="flex items-center gap-4">
                <label id="mode-toggle" class="mode-toggle-btn">
                    <svg class="moon-icon icon" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M21.73 17.51a1.2 1.2 0 01-1.35.34A9.91 9.91 0 0013.06 4.3a1.2 1.2 0 01-1.1-2.12c-.22-.38-.72-.51-1.12-.32A10.87 10.87 0 002.5 12c0 5.92 4.8 10.74 10.71 10.74a10.87 10.87 0 008.85-4.54 1.2 1.2 0 01.37-1.07zm-2.88-2.67a8.55 8.55 0 01-6.15 2.53A8.53 8.53 0 015.65 12a8.55 8.55 0 016.15-2.52 8.53 8.53 0 017.05 4.7z"></path>
                    </svg>
                    <svg class="sun-icon icon" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 4.5a.9.9 0 00-1 0 .9.9 0 00-.5 1.5l1.62 1.62a.9.9 0 001.28 0l1.62-1.62a.9.9 0 00-.5-1.5zM3 12a.9.9 0 001.8 0 .9.9 0 00-1.8 0zM21 12a.9.9 0 001.8 0 .9.9 0 00-1.8 0zM12 21a.9.9 0 001-1.5l-1.62-1.62a.9.9 0 00-1.28 0L9.5 19.5a.9.9 0 00.5 1.5zM5.5 5.5a.9.9 0 00-1.27 0 .9.9 0 000 1.28l1.62 1.62a.9.9 0 001.28 0l1.62-1.62a.9.9 0 00-1.28 0zM18.5 18.5a.9.9 0 00-1.27 0 .9.9 0 000 1.28l1.62 1.62a.9.9 0 001.28 0l1.62-1.62a.9.9 0 00-1.28 0zM18.5 5.5a.9.9 0 00-1.27 0 .9.9 0 000 1.28l1.62 1.62a.9.9 0 001.28 0l1.62-1.62a.9.9 0 00-1.28 0zM5.5 18.5a.9.9 0 00-1.27 0 .9.9 0 000 1.28l1.62 1.62a.9.9 0 001.28 0l1.62-1.62a.9.9 0 00-1.28 0zM12 10.5a1.5 1.5 0 100 3 1.5 1.5 0 000-3z"></path>
                    </svg>
                </label>
                <div class="flex flex-col items-start sm:items-end text-sm text-gray-400">
                    <span id="userIdDisplay" class="truncate">User: Loading...</span>
                    <button id="logout-btn" class="mt-1 text-red-400 hover:text-red-500 font-semibold">Log Out</button>
                </div>
            </div>
        </header>

        <div id="statusMessage" class="opacity-0 transition-opacity duration-300"></div>

        <div class="flex border-b border-gray-700 mb-6">
            <button id="tab-btn-dashboard" class="tab-button flex-1 text-center py-3 text-lg font-semibold text-gray-400 hover:text-gray-200 hover:border-gray-500">Dashboard</button>
            <button id="tab-btn-assistant" class="tab-button flex-1 text-center py-3 text-lg font-semibold text-gray-400 hover:text-gray-200 hover:border-gray-500">AI Assistant</button>
            <button id="tab-btn-diagnostics" class="tab-button flex-1 text-center py-3 text-lg font-semibold text-gray-400 hover:text-gray-200 hover:border-gray-500">Diagnostics</button>
            <button id="tab-btn-crops" class="tab-button flex-1 text-center py-3 text-lg font-semibold text-gray-400 hover:text-gray-200 hover:border-gray-500">What's Growing?</button>
        </div>

        <div id="dashboard-tab" class="tab-content view">
            <div id="dashboardView" class="view">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                    <div class="bg-gray-800 p-6 rounded-xl shadow-inner border border-gray-700">
                        <h3 class="text-sm text-gray-400 mb-2">System Status</h3>
                        <div class="flex items-center justify-between">
                            <span id="systemStatus" class="text-xl font-bold text-green-400">All Zones OK</span>
                            <div id="pumpIndicator" class="w-4 h-4 rounded-full bg-red-500 animate-pulse"></div>
                        </div>
                    </div>
                    <div class="bg-gray-800 p-6 rounded-xl shadow-inner border border-gray-700">
                        <h3 class="text-sm text-gray-400 mb-2">Current Weather</h3>
                        <div class="flex items-center gap-2">
                            <svg class="w-8 h-8 text-yellow-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364-6.364l-.707-.707M6.343 17.657l-.707.707M16.364 6.364l.707-.707M6.343 6.343l.707-.707M12 8a4 4 0 100 8 4 4 0 000-8z"></path>
                            </svg>
                            <div>
                                <span id="currentWeatherCondition" class="text-xl font-bold text-gray-100">Loading...</span>
                                <span class="text-sm text-gray-400"><span id="currentTemperature"></span>, <span id="currentHumidity"></span></span>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-800 p-6 rounded-xl shadow-inner border border-gray-700">
                        <h3 class="text-sm text-gray-400 mb-2">Next Watering</h3>
                        <p class="text-lg font-bold text-gray-100">Tomorrow at 6:00 AM</p>
                        <p class="text-xs text-gray-500">Scheduled by AI</p>
                    </div>
                </div>

                <div class="bg-gray-800 p-6 rounded-xl shadow-inner border border-green-500 mb-8">
                    <h3 class="text-xl font-bold text-green-400 mb-4">‚≠ê ESP32 RAW Live Feed ‚≠ê</h3>
                    <div class="space-y-2 text-gray-400">
                        <p>Soil Moisture: <span id="soil" class="text-gray-100 font-bold">...Loading</span></p>
                        <p>Temperature: <span id="temperature" class="text-gray-100 font-bold">...Loading</span></p>
                        <p>Humidity: <span id="humidity" class="text-gray-100 font-bold">...Loading</span></p>
                        <p>Pump Status: <span id="status" class="text-gray-100 font-bold">...Loading</span></p>
                    </div>
                </div>
                <div class="bg-gray-800 p-6 rounded-xl shadow-inner border border-gray-700 mb-8">
                    <h3 class="text-lg font-semibold text-gray-100 mb-4">Garden Zone</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div class="zone-card relative bg-gray-700 rounded-lg p-6 text-center cursor-pointer hover:bg-gray-600 transition-colors" data-zone="zone1" id="zone1-moisture-card">
                            <span class="status-indicator absolute top-2 right-2 w-3 h-3 rounded-full bg-green-500 animate-pulse"></span>
                            <img id="zone1-live-image" class="w-full h-auto rounded-lg mb-2" src="https://placehold.co/200x150/52382f/ffffff?text=Flower+Bed" alt="Live soil image">
                            <h4 class="text-base font-semibold text-gray-100">Flower Bed</h4>
                            <p class="text-sm text-gray-400">Moisture: <span class="moisture-value">75%</span></p>
                        </div>
                        <div class="zone-card relative bg-gray-700 rounded-lg p-6 text-center cursor-pointer hover:bg-gray-600 transition-colors" data-zone="zone2" id="zone2-moisture-card">
                            <span class="status-indicator absolute top-2 right-2 w-3 h-3 rounded-full bg-yellow-500"></span>
                            <img id="zone2-live-image" class="w-full h-auto rounded-lg mb-2" src="https://placehold.co/200x150/474c3e/ffffff?text=Lawn" alt="Live soil image">
                            <h4 class="text-base font-semibold text-gray-100">Lawn</h4>
                            <p class="text-sm text-gray-400">Moisture: <span class="moisture-value">40%</span></p>
                        </div>
                        <div class="zone-card relative bg-gray-700 rounded-lg p-6 text-center cursor-pointer hover:bg-gray-600 transition-colors" data-zone="zone3" id="zone3-moisture-card">
                            <span class="status-indicator absolute top-2 right-2 w-3 h-3 rounded-full bg-red-500"></span>
                            <img id="zone3-live-image" class="w-full h-auto rounded-lg mb-2" src="https://placehold.co/200x150/453b3d/ffffff?text=Vegetable+Patch" alt="Live soil image">
                            <h4 class="text-base font-semibold text-gray-100">Vegetable Patch</h4>
                            <p class="text-sm text-gray-400">Moisture: <span class="moisture-value">22%</span></p>
                        </div>
                        <div class="zone-card relative bg-gray-700 rounded-lg p-6 text-center cursor-pointer hover:bg-gray-600 transition-colors" data-zone="zone4" id="zone4-moisture-card">
                            <span class="status-indicator absolute top-2 right-2 w-3 h-3 rounded-full bg-green-500"></span>
                            <img id="zone4-live-image" class="w-full h-auto rounded-lg mb-2" src="https://placehold.co/200x150/615a45/ffffff?text=Fruit+Trees" alt="Live soil image">
                            <h4 class="text-base font-semibold text-gray-100">Fruit Trees</h4>
                            <p class="text-sm text-gray-400">Moisture: <span class="moisture-value">68%</span></p>
                        </div>
                    </div>
                </div>

                <div class="bg-gray-800 p-6 rounded-xl shadow-inner border border-gray-700">
                    <h3 class="text-lg font-semibold text-gray-100 mb-4">AI & System Control</h3>
                    
                    <div class="flex items-center justify-between mb-4">
                        <span class="text-gray-400">Enable AI-Powered Mode</span>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="aiModeToggle" class="sr-only peer" checked>
                            <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-green-400 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div>
                        </label>
                    </div>
                    
                    <div id="aiRecommendations">
                        <p class="text-gray-400 mb-4">The AI is actively monitoring conditions and optimizing your schedule.</p>
                        <div class="p-4 bg-gray-700 rounded-lg">
                            <p id="aiRecommendationMessage" class="text-sm text-gray-200">
                                **AI Prediction:** "Loading initial data..."
                            </p>
                        </div>
                    </div>

                    <div id="manualControls" class="hidden">
                        <p class="text-gray-400 mb-4">You have disabled AI mode. Manual controls are now active.</p>
                        <button id="pumpControlButton" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-xl transition-colors">
                            START PUMP
                        </button>
                        <p class="text-center text-gray-500 text-xs mt-2">Current pump status: <span id="pumpStatusText">OFF</span></p>
                    </div>
                </div>
            </div>

            <div id="zoneDetailView" class="view hidden">
                <button id="showDashboard" class="text-gray-400 hover:text-gray-200 mb-6 flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                    Back to Dashboard
                </button>
                <h2 id="zoneDetailTitle" class="text-3xl font-bold text-gray-100 mb-6">Flower Bed - Zone 1</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                    <div class="bg-gray-800 p-6 rounded-xl shadow-inner border border-gray-700">
                        <h3 class="text-sm text-gray-400 mb-2">Soil Moisture</h3>
                        <div class="flex items-end gap-2 mb-2">
                            <span id="moistureValue" class="text-4xl font-extrabold text-green-400">75%</span>
                        </div>
                        <div class="w-full bg-gray-700 h-2 rounded-full overflow-hidden">
                            <div id="moistureBar" class="h-full rounded-full" style="width: 75%;"></div>
                        </div>
                    </div>
                    
                    <div class="bg-gray-800 p-6 rounded-xl shadow-inner border border-gray-700">
                        <h3 class="text-sm text-gray-400 mb-2">Temperature</h3>
                        <span id="tempValue" class="text-4xl font-extrabold text-gray-100">25¬∞C</span>
                        <p class="text-sm text-gray-500 mt-1">Optimal for this crop</p>
                    </div>
                    
                    <div class="bg-gray-800 p-6 rounded-xl shadow-inner border border-gray-700">
                        <h3 class="text-sm text-gray-400 mb-2">Humidity</h3>
                        <span id="humidityValue" class="text-4xl font-extrabold text-gray-100">65%</span>
                        <p class="text-sm text-gray-500 mt-1">Air humidity</p>
                    </div>
                </div>
                
                <div class="bg-gray-800 p-6 rounded-xl shadow-inner border border-gray-700">
                    <h3 class="text-lg font-semibold text-gray-100 mb-4">Moisture Trends (Past 7 Days)</h3>
                    <div class="w-full h-48 relative">
                        <canvas id="moistureChart"></canvas>
                    </div>
                </div>
                </div>
        </div>
        
        <div id="assistant-tab" class="tab-content hidden">
            <div class="flex flex-col h-[60vh] max-h-[60vh] bg-gray-800 rounded-xl shadow-inner border border-gray-700">
                <div id="chatMessages" class="flex-1 p-6 overflow-y-auto flex flex-col space-y-3">
                    <div class="p-3 rounded-lg max-w-[80%] bg-gray-700 text-gray-200 mr-auto">
                        Hello! I am Hydro-AI, your smart irrigation assistant. How can I help?
                    </div>
                </div>
                <div class="p-4 border-t border-gray-700 flex items-center gap-2">
                    <input id="chatInput" type="text" placeholder="Ask about soil moisture, weather, or pump status..." class="flex-1 bg-gray-900 text-white rounded-full px-4 py-2 focus:outline-none focus:ring-2 focus:ring-green-500">
                    <button id="voiceButton" class="bg-gray-700 hover:bg-gray-600 rounded-full p-2 transition-colors">
                        <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a4 4 0 11-8 0 4 4 0 018 0z"></path>
                        </svg>
                    </button>
                    <button id="sendButton" class="bg-green-600 hover:bg-green-700 text-white rounded-full p-2 transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M12 5l7 7-7 7"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        
        <div id="diagnostics-tab" class="tab-content hidden">
            <h3 class="text-2xl font-bold text-gray-100 mb-4">System Health & Diagnostics</h3>
            <p class="text-sm text-gray-400 mb-6">Hydro-AI continuously monitors all components and provides real-time health checks and suggestions.</p>
            <div id="diagnosticsContainer" class="flex flex-col space-y-4">
                </div>
        </div>

        <div id="crops-tab" class="tab-content hidden">
            <h3 class="text-2xl font-bold text-gray-100 mb-4">What's Growing?</h3>
            <p class="text-sm text-gray-400 mb-6">Here are the crops in your garden and their specific care needs.</p>
            <div id="cropsContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                </div>
        </div>
        
    </div>
</body>
</html>
